<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>âœ… To Do List</title>
  <!-- Load Pyodide early and synchronously to avoid race conditions -->

  <!-- Preload Pyodide JS and WASM for faster startup -->
  <link rel="preload" href="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js" as="script">
  <link rel="preload" href="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.wasm" as="fetch" type="application/wasm" crossorigin>

  <!-- Load Pyodide normally -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>

  <style>
    body {
      background: #111;
      color: #fff;
      font-family: "Courier New", monospace;
      margin: 0;
      height: 100vh;
      font-size: 0.9em;
    }
    #terminal {
      position: relative;
      background: #000;
      height: 100vh;
      padding: 10px;
      border-top: 2px solid #444;
      box-sizing: border-box;
    }
    #header { margin-bottom: 1em; white-space: pre-wrap; }
    #output {
      white-space: pre-wrap;
      overflow-y: auto;
      height: calc(100vh - 10px - 10px - 1em - 48px);
      scrollbar-width: none;
    }
    #output::-webkit-scrollbar { display: none; }
    #output::after { content: ""; display: block; height: 64px; }
    #input-line {
      position: absolute; bottom: 0; left: 0; right: 0;
      padding: 10px; background: #000; border-top: 1px solid #333;
      display: flex; align-items: center; height: 48px;
    }
    #prompt { margin-right: 6px; }

    /* --- Fake block cursor --- */
    #command {
      outline: none;
      white-space: pre;
      caret-color: transparent;
      display: inline-block;
      min-width: 1ch; /* keeps baseline stable when empty */
      min-width: 1ch;
    }
    #command::after {
      content: "";
      display: inline-block;
      width: 8px;
      height: 1em;
      background: #fff;
      animation: blink 1s steps(1) infinite;
      vertical-align: bottom; /* keep aligned with text baseline */
      vertical-align: bottom;
    }
    @keyframes blink {
      50% { background: transparent; }
    }
  </style>
</head>
<body>
  <div id="terminal">
    <div id="header"></div>
    <div id="output">
Welcome to To Do List  

Options:  

1. Add Task  

2. Remove Task  

3. Quit  

Enter Your Choice, 1, 2, or 3       
    </div>
    <div id="input-line">
      <span id="prompt">>>> </span>
@@ -102,126 +108,121 @@
        removed = todo_list.pop()
        print(f"Task '{removed}' removed from the To Do List")
    else:
        print("Your To Do List is empty")
    print()
  </script>

  <script>
    /* --- Banner --- */
    function formatDate() {
      const now = new Date();
      return `${now.toDateString()} ${now.getHours().toString().padStart(2,"0")}:${now.getMinutes().toString().padStart(2,"0")}`;
    }
    function updateHeader() {
      document.getElementById("header").textContent =
`Python 3.15.0 (main, ${formatDate()}) [Clang 14.0.0]
Type "help", "copyright", "credits" or "license" for more information.`;
    }
    updateHeader(); setInterval(updateHeader, 60000);

    /* --- Input + cursor baseline stability --- */
    const cmdEl = document.getElementById("command");

    function sanitizeInput(raw) {
      // Remove zero-width (ZWSP, ZWNJ, ZWJ), NBSP and normal spaces at ends
      return raw
        .replace(/[\u200B\u200C\u200D]/g, "")  // zero-width chars
        .replace(/\u00A0/g, " ")               // non-breaking space -> space
        .trim()
        .toLowerCase();
    }

    // Keep a tiny buffer so baseline never collapses underneath
    function normalizeCommand() {
      if (cmdEl.innerText === "") {
        // Use a normal space; visually invisible next to prompt, keeps baseline stable
        cmdEl.textContent = " ";
        cmdEl.textContent = " "; // buffer space keeps cursor level
      }
    }

    /* --- Output handling --- */
    function appendAndStick(text) {
      const out = document.getElementById("output");
      out.textContent += text;
      out.scrollTop = out.scrollHeight;
    }

    /* --- Pyodide bootstrap --- */
    let pyodideInstance = null;
    let commandQueue = [];
    async function initPyodide() {
      try {
        const pyodide = await loadPyodide();
        await pyodide.runPythonAsync(document.getElementById("py-code").textContent);
        pyodideInstance = pyodide;
        // Replay queued commands
        const queued = commandQueue.slice();
        commandQueue = [];
        for (const q of queued) {
          await runCommand(q);
        }
      } catch (e) {
        appendAndStick(`\n[Error] Python failed to load. Try refreshing.\n`);
        console.error(e);
      }
    }

    /* --- Command handler --- */
    let awaitingTask = false;

    async function runCommand(cmdRaw) {
      const cmd = sanitizeInput(cmdRaw);
      if (!cmd) return; // ignore empty/no-op submissions
      if (!cmd) return;

      if (!pyodideInstance) {
        // Buffer until Python is ready
        commandQueue.push(cmd);
        // Provide immediate feedback so it feels live
        appendAndStick(`\n>>> ${cmd}\n\n[Loading Python... command queued]\n`);
        return;
      }

      let output = "";
      pyodideInstance.setStdout({ batched: s => output += s });

      if (awaitingTask) {
        await pyodideInstance.runPythonAsync(`add_task(${JSON.stringify(cmd)})`);
        awaitingTask = false;
        appendAndStick(`\n>>> ${cmd}\n\n${output}`);
        return;
      }

      if (cmd === "1") {
        output = "Adding task\n\nEnter the task:";
        awaitingTask = true;
      } else if (cmd === "2") {
        output = "Removing task\n\n";
        await pyodideInstance.runPythonAsync("remove_task()");
      } else if (cmd === "3") {
        await pyodideInstance.runPythonAsync("todo_list.clear()");
        output = "Quitting\n\nYour To Do List is empty";
      } else if (cmd === "help") {
        output = "Type the number of an option to execute it.\n\n1 = Add a task\n2 = Remove the last task\n3 = Quit the program";
      } else if (cmd === "credits") {
        output = "This was originally created on Mimo.";
      } else if (cmd === "copyright") {
        output = "Copyright (c) 2001-2025 Python Software Foundation.\nAll Rights Reserved.";
      } else if (cmd === "license") {
        output = "Python is distributed under the PSF License.\nSee https://docs.python.org/3/license.html for details.";
      } else {
        output = "Invalid choice";
      }

      appendAndStick(`\n>>> ${cmd}\n\n${output}`);
    }

    /* --- Key handling --- */
    cmdEl.addEventListener("keydown", e => {
      if (e.key === "Enter") {
        e.preventDefault();
        e.stopPropagation();
        const raw = cmdEl.innerText;
        cmdEl.textContent = " "; // reset buffer to keep baseline stable
        cmdEl.textContent = " "; // reset buffer
        runCommand(raw);
      }
    });
