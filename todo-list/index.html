<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>âœ… To Do List</title>

  <!-- MicroPython WebAssembly runtime (example path; use a maintained build) -->
  <script src="https://micropython.org/resources/micropython.js"></script>

  <style>
    body {
      background: #111;
      color: #fff;
      font-family: "Courier New", monospace;
      margin: 0;
      height: 100vh;
      font-size: 0.9em;
    }
    #terminal {
      position: relative;
      background: #000;
      height: 100vh;
      padding: 10px;
      border-top: 2px solid #444;
      box-sizing: border-box;
    }
    #header { margin-bottom: 1em; white-space: pre-wrap; }
    #output {
      white-space: pre-wrap;
      overflow-y: auto;
      height: calc(100vh - 10px - 10px - 1em - 48px);
      scrollbar-width: none;
    }
    #output::-webkit-scrollbar { display: none; }
    #output::after { content: ""; display: block; height: 64px; }
    #input-line {
      position: absolute; bottom: 0; left: 0; right: 0;
      padding: 10px; background: #000; border-top: 1px solid #333;
      display: flex; align-items: center; height: 48px;
    }
    #prompt { margin-right: 6px; }

    #command {
      outline: none;
      white-space: pre;
      caret-color: transparent;
      display: inline-block;
      min-width: 1ch;
    }
    #command::after {
      content: "";
      display: inline-block;
      width: 8px;
      height: 1em;
      background: #fff;
      animation: blink 1s steps(1) infinite;
      vertical-align: bottom;
    }
    @keyframes blink {
      50% { background: transparent; }
    }
  </style>
</head>
<body>
  <div id="terminal">
    <div id="header"></div>
    <div id="output">
Welcome to To Do List  

Options:  

1. Add Task  

2. Remove Task  

3. Quit  

Enter Your Choice, 1, 2, or 3       
    </div>
    <div id="input-line">
      <span id="prompt">>>> </span>
      <span id="command" contenteditable="true"></span>
    </div>
  </div>

  <!-- Python logic -->
  <script id="py-code" type="text/plain">
_output = []

def py_print(*args):
    s = " ".join(str(a) for a in args)
    _output.append(s)

def flush_output():
    s = "\n".join(_output)
    _output.clear()
    return s

todo_list = []

def show_list():
    if todo_list:
        for i, task in enumerate(todo_list, 1):
            py_print(f"{i}. {task}")
    py_print("")

def add_task(task):
    todo_list.append(task)
    py_print(f"Task '{task}' added to the To Do List")
    py_print("")

def remove_task():
    if todo_list:
        removed = todo_list.pop()
        py_print(f"Task '{removed}' removed from the To Do List")
    else:
        py_print("Your To Do List is empty")
    py_print("")
  </script>

  <script>
    function formatDate() {
      const now = new Date();
      return `${now.toDateString()} ${now.getHours().toString().padStart(2,"0")}:${now.getMinutes().toString().padStart(2,"0")}`;
    }
    function updateHeader() {
      document.getElementById("header").textContent =
`Python 3.15.0 (main, ${formatDate()}) [Clang 14.0.0]
Type "help", "copyright", "credits" or "license" for more information.`;
    }
    updateHeader(); setInterval(updateHeader, 60000);

    const cmdEl = document.getElementById("command");

    function sanitizeInput(raw) {
      return raw
        .replace(/[\u200B\u200C\u200D]/g, "")
        .replace(/\u00A0/g, " ")
        .trim()
        .toLowerCase();
    }

    function normalizeCommand() {
      if (cmdEl.innerText === "") {
        cmdEl.textContent = " ";
      }
    }

    function appendAndStick(text) {
      const out = document.getElementById("output");
      out.textContent += text;
      out.scrollTop = out.scrollHeight;
    }

    let mpReady = false;
    let pyStdout = "";
    window.mp_js_stdout = s => { pyStdout += s; };

    async function initMicroPython() {
      mp_js_init(128 * 1024);
      const code = document.getElementById("py-code").textContent;
      mp_js_do_str(code);
      mpReady = true;
    }

    let awaitingTask = false;
    let commandQueue = [];

    function runCommand(cmdRaw) {
      const cmd = sanitizeInput(cmdRaw);
      if (!cmd) return;

      if (!mpReady) {
        appendAndStick(`\n>>> ${cmd}\n\n[Loading Python... command queued]\n`);
        commandQueue.push(cmd);
        return;
      }

      let output = "";
      pyStdout = "";

      if (awaitingTask) {
        mp_js_do_str(`add_task(${JSON.stringify(cmd)})`);
        awaitingTask = false;
        output = pyStdout;
        appendAndStick(`\n>>> ${cmd}\n\n${output}`);
        return;
      }

      if (cmd === "1") {
        output = "Adding task\n\nEnter the task:";
        awaitingTask = true;
      } else if (cmd === "2") {
        mp_js_do_str("remove_task()");
        output = pyStdout;
      } else if (cmd === "3") {
        mp_js_do_str("todo_list.clear()");
        output = "Quitting\n\nYour To Do List is empty";
      } else if (cmd === "help") {
        output = "Type the number of an option to execute it.\n\n1 = Add a task\n2 = Remove the last task\n3 = Quit the program";
      } else if (cmd === "credits") {
        output = "This was originally created on Mimo.";
      } else if (cmd === "copyright") {
        output = "Copyright (c) 2001-2025 Python Software Foundation.\nAll Rights Reserved.";
      } else if (cmd === "license") {
        output = "Python is distributed under the PSF License.\nSee https://docs.python.org/3/license.html for details.";
      } else {
        output = "Invalid choice";
      }

      appendAndStick(`\n>>> ${cmd}\n\n${output}`);
    }

    cmdEl.addEventListener("keydown", e => {
      if (e.key === "Enter") {
        e.preventDefault();
        e.stopPropagation();
        const raw = cmdEl.innerText;
        cmdEl.textContent = " ";
        runCommand(raw);
      }
    });
    cmdEl.addEventListener("input", normalizeCommand);

    window.addEventListener("load", () => {
      normalizeCommand();
      cmdEl.focus();
      initMicroPython();
      const checkReady = setInterval(() => {
        if (mpReady) {
          clearInterval(checkReady);
          const pending = commandQueue.slice();
          commandQueue = [];
          pending.forEach(runCommand);
        }
      }, 50);
    });
  </script>
</body>
</html>
