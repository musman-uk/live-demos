<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>âœ… To Do List</title>
  <script src="https://micropython.org/resources/micropython.js"></script>
  <style>
    html, body { height:100%; margin:0; }
    body {
      background:#000; color:#fff; font-family:"Courier New",monospace;
      font-size:0.9em; overflow:hidden; cursor:none;
    }
    #terminal { display:flex; flex-direction:column; height:100%; padding:10px; box-sizing:border-box; }
    #header { white-space:pre-wrap; margin-bottom:1em; }
    #output { flex:1 1 auto; white-space:pre-wrap; overflow-y:auto; scrollbar-width:none; }
    #output::-webkit-scrollbar { display:none; }
    #input-line { flex:0 0 auto; display:flex; align-items:center; border-top:1px solid #222; padding-top:6px; }
    #prompt { margin-right:6px; }
    #command { outline:none; white-space:pre; caret-color:transparent; display:inline-block; min-width:1ch; }
    #command::after { content:""; display:inline-block; width:8px; height:1em; background:#fff;
      animation:blink 1s steps(1) infinite; vertical-align:bottom; }
    @keyframes blink { 50%{background:transparent;} }
  </style>
</head>
<body>
  <div id="terminal">
    <div id="header"></div>
    <div id="output">
Welcome to To Do List  

Options:  

1. Add Task  

2. Remove Task  

3. Quit  

Enter Your Choice, 1, 2, or 3       
    </div>
    <div id="input-line">
      <span id="prompt">>>> </span>
      <span id="command" contenteditable="true"></span>
    </div>
  </div>

  <!-- Python logic -->
  <script id="py-code" type="text/plain">
_output = []
def py_print(*args):
    _output.append(" ".join(str(a) for a in args))

def flush_output():
    s = "\n".join(_output)
    _output.clear()
    return s

todo_list = []

def add_task(task):
    todo_list.append(task)
    py_print(f"Task '{task}' added")

def remove_task():
    if todo_list:
        removed = todo_list.pop()
        py_print(f"Task '{removed}' removed")
    else:
        py_print("Your To Do List is empty")
  </script>

  <script>
    const cmdEl=document.getElementById("command"), outEl=document.getElementById("output");

    function sanitize(raw){ return raw.replace(/[\u200B\u200C\u200D]/g,"").replace(/\u00A0/g," ").trim(); }
    function normalize(){ if(cmdEl.innerText==="") cmdEl.textContent=" "; }
    let autoStick=true;
    function atBottom(){ return Math.abs(outEl.scrollHeight - outEl.scrollTop - outEl.clientHeight) < 4; }
    function append(txt){ outEl.textContent+=txt; if(autoStick) outEl.scrollTop=outEl.scrollHeight; }
    outEl.addEventListener("scroll",()=>{ autoStick=atBottom(); });

    // MicroPython stdout capture
    window.mp_js_stdout_buffer="";
    window.mp_js_stdout=s=>{ window.mp_js_stdout_buffer+=s; };
    function initMicroPython(){ mp_js_init(128*1024); mp_js_do_str(document.getElementById("py-code").textContent); }
    function flushPy(){
      window.mp_js_stdout_buffer="";
      mp_js_do_str("print(flush_output())");
      const s=window.mp_js_stdout_buffer;
      window.mp_js_stdout_buffer="";
      return s;
    }
    function runPy(code){ mp_js_do_str(code); return flushPy(); }

    const MENU_TEXT = `

Options:  

1. Add Task  

2. Remove Task  

3. Quit  

Enter Your Choice, 1, 2, or 3       `;

    let awaitingTask=false;
    function isMenuCommand(c){
      return ["1","2","3","help","credits","license","copyright"].includes(c);
    }

    function runCommand(raw){
      const cmd=sanitize(raw);
      const low=cmd.toLowerCase();
      append(`\n>>> ${cmd}\n\n`);
      if(!low) return;

      if(isMenuCommand(low)){
        awaitingTask=false;
        if(low==="1"){ append("Enter task"); awaitingTask=true; return; }
        if(low==="2"){ append(runPy("remove_task()")); return; }
        if(low==="3"){ mp_js_do_str("todo_list.clear()"); append("Your To Do List is empty"+MENU_TEXT); return; }
        if(low==="help"){ append("Type the number of an option to execute it.\n\n1 = Add a task\n2 = Remove the last task\n3 = Quit the program"); return; }
        if(low==="credits"){ append("This was originally created on Mimo."); return; }
        if(low==="license"){ append("Python is distributed under the PSF License.\nSee https://docs.python.org/3/license.html for details."); return; }
        if(low==="copyright"){ append("Copyright (c) 2001-2025 Python Software Foundation.\nAll Rights Reserved."); return; }
      }

      if(awaitingTask){
        append(runPy(`add_task(${JSON.stringify(cmd)})`));
        awaitingTask=false;
        return;
      }

      append("Input not recognized, please type a valid input");
    }

    cmdEl.addEventListener("keydown",e=>{
      if(e.key==="Enter"){ e.preventDefault(); const raw=cmdEl.innerText; cmdEl.textContent=" "; runCommand(raw); }
    });
    cmdEl.addEventListener("input",normalize);

    // Header
    function formatDate(){
      const n=new Date();
      return `${n.toDateString()} ${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}`;
    }
    function updateHeader(){
      document.getElementById("header").textContent =
`Python 3.15.0 (main, ${formatDate()}) [Clang 14.0.0]
Type "help", "credits", "license", "copyright"
for more information.`;
    }
    updateHeader(); setInterval(updateHeader,60000);

    window.addEventListener("load",()=>{ normalize(); cmdEl.focus(); initMicroPython(); });

    // Hidden mouse trick
    let cursorTimer=null;
    window.addEventListener("mousemove",()=>{
      document.body.style.cursor="default";
      clearTimeout(cursorTimer);
      cursorTimer=setTimeout(()=>{ document.body.style.cursor="none"; },1200);
    });
  </script>
</body>
</html>
